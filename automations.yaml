################################################
#
#      Harmony Automations
#
################################################

- alias: Close Bedroom Curtains At Sunset
  trigger:
  - event: sunset
    platform: sun
    offset: '-00:30:00'
  condition:
    condition: state
    entity_id: input_boolean.bedroom_curtains
    state: 'on'
  action:
  - service: script.turn_on
    entity_id: script.close_bedroom_curtains
    
- alias: Close Bay Window Curtains At Sunset
  trigger:
  - event: sunset
    platform: sun
    offset: '-00:30:00'
  condition:
    condition: state
    entity_id: input_boolean.bay_window_curtains
    state: 'on'
  action:
  - service: script.turn_on
    entity_id: script.close_bay_window_curtains

- alias: Outside Speakers CC
  trigger:
  - platform: state
    entity_id: media_player.outdoor_speakers
    to: 'playing'
  - platform: state
    entity_id: media_player.outdoor_speakers
    to: 'idle'
  action:
  - service: script.turn_on
    entity_id: script.zone_2_cc

- alias: Set Den Harmony Off
  trigger:
    platform: state
    entity_id: remote.harmony_hub_den
  condition:
    condition: template
    value_template: '{{ trigger.to_state.attributes.current_activity == "PowerOff" }}'
  action:
  - service: switch.turn_off
    entity_id: switch.den_fan
  - service: switch.turn_off
    entity_id: switch.kitchen_tv
  - service: light.turn_off
    entity_id: light.tv_lights
  - condition: state
    entity_id: switch.fireplace
    state: 'on'
  - service: switch.turn_off
    entity_id: switch.fireplace

- alias: Set Bedroom Booleans Off
  trigger:
    platform: state
    entity_id: remote.harmony_hub_bed
  condition:
    condition: template
    value_template: '{{ trigger.to_state.attributes.current_activity == "PowerOff" }}'
  action:
  - service: light.turn_off
    entity_id: light.biased_lights
     
- alias: Fireplace and TV Lights Between Sunset and Sunrise
  trigger:
  - platform: state
    entity_id: remote.harmony_hub_den
    to: 'on'
  - platform: sun
    event: sunset
    offset: "00:01:00"
  condition:
    condition: and
    conditions:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: template
      value_template: "{{ states.remote.harmony_hub_den.attributes.current_activity != 'PowerOff' }}"
  action:
  - service: light.turn_on
    entity_id: light.tv_lights
    data:
      brightness_pct: 100
      kelvin: 6500
  - condition: state
    entity_id: switch.fireplace
    state: 'off'
  - service: switch.turn_on
    entity_id: switch.fireplace

- alias: Turn on Fireplace and TV Lights Night
  trigger:
  - event: sunset
    platform: sun
    offset: '-00:30:00'
  condition:
    condition: template
    value_template: "{{ states.remote.harmony_hub_den.attributes.current_activity != 'PowerOff' }}"
  action:
  - service: light.turn_on
    entity_id: light.tv_lights
    data:
      brightness_pct: 100
      kelvin: 6500
  - condition: state
    entity_id: switch.fireplace
    state: 'off'
  - service: switch.turn_on
    entity_id: switch.fireplace

- alias: Turn on bias lighting bedroom at night
  trigger:
  - platform: state
    entity_id: remote.harmony_hub_bed
  - platform: sun
    event: sunset
  condition:
    condition: and
    conditions:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: or
      conditions:
      - condition: template
        value_template: '{{ trigger.to_state.attributes.current_activity == "Watch Fire TV" }}'
      - condition: template
        value_template: '{{ trigger.to_state.attributes.current_activity == "Bedroom Chromecast" }}'
      - condition: template
        value_template: '{{ trigger.to_state.attributes.current_activity == "Bedroom bluray" }}'
  action:
  - service: light.turn_on
    entity_id: light.biased_lights
    data:
      brightness_pct: 100
      kelvin: 6500

- alias: Curtain booleans hass restart
  trigger:
    platform: homeassistant
    event: start
  condition: 
    condition: sun
    before: sunset
  action:
  - service: input_boolean.turn_on
    entity_id: input_boolean.bedroom_curtains
  - service: input_boolean.turn_on
    entity_id: input_boolean.bay_window_curtains

- alias: Den Curtains hass restart
  trigger:
    platform: homeassistant
    event: start
  action:
  - service: input_boolean.turn_on
    entity_id: input_boolean.den_curtains

- alias: Harmony Den activity start
  trigger:
    platform: state
    entity_id: input_select.harmony_den
    from: 'Select Input'
  action:
  - service: remote.turn_on
    entity_id: remote.harmony_hub_den
    data_template:
      activity: >
        {% if is_state("input_select.harmony_den", "Netflix") %}
          19168891
        {% elif is_state("input_select.harmony_den", "Watch Roku") %}
          27030102
        {% elif is_state("input_select.harmony_den", "Watch PC") %}
          25516536
        {% elif is_state("input_select.harmony_den", "Watch Smart TV") %}
          19688407
        {% elif is_state("input_select.harmony_den", "Xbox") %}
          22642672
        {% else %}
        {% endif %}
  - service: input_select.select_option
    entity_id: input_select.harmony_den
    data_template:
      option: "Select Input"
      
- alias: Harmony Bed activity start
  trigger:
    platform: state
    entity_id: input_select.harmony_bed
    from: 'Select Input'
  action:
  - service: remote.turn_on
    entity_id: remote.harmony_hub_bed
    data_template:
      activity: >
        {% if is_state("input_select.harmony_den", "Bedroom Bluray") %}
          23738920
        {% elif is_state("input_select.harmony_den", "Bedroom Chromecast") %}
          23739184
        {% elif is_state("input_select.harmony_den", "Watch Fire TV") %}
          19492437
        {% else %}
        {% endif %}
  - service: input_select.select_option
    entity_id: input_select.harmony_bed
    data_template:
      option: "Select Input"
      
- alias: Harmony Den power off
  trigger:
    platform: state
    entity_id: input_select.harmony_den
    to: 'Power Off'
  action:
  - service: remote.turn_off
    entity_id: remote.harmony_hub_den
  - service: input_select.select_option
    entity_id: input_select.harmony_den
    data_template:
      option: "Select Input"
      
- alias: Harmony Bed power off
  trigger:
    platform: state
    entity_id: input_select.harmony_bed
    to: 'Power Off'
  action:
  - service: remote.turn_off
    entity_id: remote.harmony_hub_bed
  - service: input_select.select_option
    entity_id: input_select.harmony_bed
    data_template:
      option: "Select Input"
      
- alias: Turn off bias lights and fireplace at sunrise
  trigger:
    platform: sun
    event: sunrise
  action:
  - service: light.turn_off
    entity_id: light.tv_lights
  - service: light.turn_off
    entity_id: light.biased_lights
  - condition: state
    entity_id: input_boolean.fireplace
    state: 'on'
  - service: switch.turn_off
    entity_id: switch.fireplace
    
- alias: Turn off bedroom tv in night mode if movie is done and you fell asleep
  trigger:
  - platform: state
    entity_id: media_player.kodi_bedroom
    from: playing
    to: idle
    for:
      minutes: 30
  condition:
    condition: state
    entity_id: input_boolean.night_mode
    state: 'on'
  action:
  - service: remote.turn_off
    entity_id: remote.harmony_hub_bed
  - delay: "00:00:15"
  - service: switch.turn_on
    entity_id: switch.bedroom_fan
    
- alias: Turn off bedroom tv in night mode when channels have been playing for 3 hours
  trigger:
  - platform: state
    entity_id: media_player.kodi_bedroom
    to: playing
    for:
      hours: 3
  condition:
    condition: and
    conditions:
    - condition: template
      value_template: "{{ states.media_player.kodi_bedroom.attributes.media_content_type == 'channel' }}"
    - condition: state
      entity_id: input_boolean.night_mode
      state: 'on'
  action:
  - service: media_player.media_stop
    entity_id: media_player.kodi_bedroom
  - service: remote.turn_off
    entity_id: remote.harmony_hub_bed
  - delay: "00:00:15"
  - service: switch.turn_on
    entity_id: switch.bedroom_fan
    
    
################################################
#
#      Laundry notifications
#   
################################################

- alias: Dryer Notification
  trigger:
    platform: state
    entity_id: sensor.dryer_running
    to: 'False'
    for:
      minutes: 3
  condition:
    condition: state
    entity_id: input_boolean.dryer_status
    state: 'on'
  action:
  - service: input_boolean.turn_off
    entity_id: input_boolean.dryer_status
  - service: notify.den
    data_template:
      data:
        color: red
        duration: 10
        position: center
      message: "The dryer is done.{% if is_state('input_boolean.washer_status', 'on') %} However the washer is still running {% else %} Time to get your clothes {% endif %}"
      title: Shokabow Zoo
  - service: notify.chrome
    data:
      message: "The dryer is done.{% if is_state('input_boolean.washer_status', 'on') %} However the washer is still running {% else %} Time to get your clothes{% endif %}"
      target: ["danny_pixel", "tosh_phone"]
      title: Shokabow Zoo
  - condition: state
    entity_id: input_boolean.night_mode
    state: 'off'
  - service: tts.google_say
    #entity_id: media_player.home_notification
    #entity_id: media_player.den_home, media_player.kitchen_home, media_player.bedroom_speaker, media_player.office_speaker, media_player.bathroom_speaker, media_player.living_room_home
    data_template:
      message: "The dryer is done.{% if is_state('input_boolean.washer_status', 'on') %} However the washer is still running {% else %} Time to get your clothes{% endif %}"
      entity_id: >
        {% if states.media_player.home_notification.state != 'unavailable' %}
          media_player.home_notification
        {% else %}
          media_player.den_home, media_player.kitchen_home, media_player.bedroom_speaker, media_player.office_speaker, media_player.bathroom_speaker, media_player.living_room_home
        {%endif %}

- alias: Washer Notification
  trigger:
    platform: state
    entity_id: sensor.washer_running
    to: 'False'
    for:
      minutes: 3
  condition:
    condition: state
    entity_id: input_boolean.washer_status
    state: 'on'
  action:
  - service: input_boolean.turn_off
    entity_id: input_boolean.washer_status
  - service: notify.den
    data_template:
      data:
        color: red
        duration: 10
        position: center
      message: "The washer is done.{% if is_state('input_boolean.dryer_status', 'on') %} However the dryer is still running {% else %} Time to switch laundry {% endif %}"
      title: Shokabow Zoo
  - service: notify.chrome
    data:
      message: "The washer is done.{% if is_state('input_boolean.dryer_status', 'on') %} However the dryer is still running {% else %} Time to switch laundry {% endif %}"
      target: ["danny_pixel", "tosh_phone"]
      title: Shokabow Zoo
  - condition: state
    entity_id: input_boolean.night_mode
    state: 'off'
  - service: tts.google_say
    #entity_id: media_player.home_notification
    #entity_id: media_player.den_home, media_player.kitchen_home, media_player.bedroom_speaker, media_player.office_speaker, media_player.bathroom_speaker, media_player.living_room_home
    data_template:
      message: "The washer is done.{% if is_state('input_boolean.dryer_status', 'on') %} However the dryer is still running {% else %} Time to switch laundry {% endif %}"
      entity_id: >
        {% if states.media_player.home_notification.state != 'unavailable' %}
          media_player.home_notification
        {% else %}
          media_player.den_home, media_player.kitchen_home, media_player.bedroom_speaker, media_player.office_speaker, media_player.bathroom_speaker, media_player.living_room_home
        {%endif %}
        
- alias: Dishwasher Notification
  trigger:
    platform: state
    entity_id: sensor.dishwasher_running
    to: 'False'
    for:
      minutes: 5
  condition:
    condition: state
    entity_id: input_boolean.dishwasher_status
    state: 'on'
  action:
  - service: notify.den
    data:
      data:
        color: red
        duration: 10
        position: center
      message: The dishes are done!
      title: Shokabow Zoo
  - service: input_boolean.turn_off
    entity_id: input_boolean.dishwasher_status
  - service: notify.chrome
    data:
      message: "The dishes are done"
      target: ["danny_pixel", "tosh_phone"]
      title: Shokabow Zoo
  - service: input_boolean.turn_on
    entity_id: input_boolean.dishes_clean
  - condition: state
    entity_id: input_boolean.night_mode
    state: 'off'
  - service: tts.google_say
    #entity_id: media_player.home_notification
    #entity_id: media_player.den_home, media_player.kitchen_home, media_player.bedroom_speaker, media_player.office_speaker, media_player.bathroom_speaker, media_player.living_room_home
    data_template:
      message: 'Dishes are done!'
      entity_id: >
        {% if states.media_player.home_notification.state != 'unavailable' %}
          media_player.home_notification
        {% else %}
          media_player.den_home, media_player.kitchen_home, media_player.bedroom_speaker, media_player.office_speaker, media_player.bathroom_speaker, media_player.living_room_home
        {%endif %}
        
- alias: Washer Start
  trigger:
    platform: state
    entity_id: sensor.washer_running
    to: 'True'
    for:
      minutes: 3
  action:
    service: input_boolean.turn_on
    entity_id: input_boolean.washer_status

- alias: Dryer Start
  trigger:
    platform: state
    entity_id: sensor.dryer_running
    to: 'True'
    for:
      minutes: 3
  action:
    service: input_boolean.turn_on
    entity_id: input_boolean.dryer_status

- alias: Dishwasher Start
  trigger:
    platform: state
    entity_id: sensor.dishwasher_running
    to: 'True'
  action:
  - service: input_boolean.turn_on
    entity_id: input_boolean.dishwasher_status
  - service: input_boolean.turn_off
    entity_id: input_boolean.dishes_clean  

################################################
#
#      TTS notifications
#
################################################

- alias: Front Door TTS
  trigger:
  - platform: state
    entity_id: binary_sensor.front_door
    to: 'on'
  - platform: state
    entity_id: binary_sensor.front_door
    to: 'off'
  action:
  - service: tts.google_say
    entity_id: media_player.living_room_home
    data_template:
      message: >
        {% if is_state("binary_sensor.front_door", "on") %}
          The front door is open
        {% elif is_state("binary_sensor.front_door", "off") %}
          The front door is closed
        {% else %}
        {% endif %}

- alias: Announce Lock Jammed
  trigger:
    platform: state
    entity_id: sensor.front_door_lock_alarm_type
    to: '9'
  action:
  - service: tts.google_say
    #entity_id: media_player.home_notification
    #entity_id: media_player.den_home, media_player.kitchen_home, media_player.bedroom_speaker, media_player.office_speaker, media_player.bathroom_speaker, media_player.living_room_home
    data_template:
      message: 'The front door lock is jammed'
      entity_id: >
        {% if states.media_player.home_notification.state != 'unavailable' %}
          media_player.home_notification
        {% else %}
          media_player.den_home, media_player.kitchen_home, media_player.bedroom_speaker, media_player.office_speaker, media_player.bathroom_speaker, media_player.living_room_home
        {%endif %}
  - service: notify.chrome
    data:
      message: "The front door lock is jammed"
      target: ["danny_pixel", "tosh_phone"]
      title: Shokabow Zoo
      
- alias: Speak close den sliding door
  trigger:
    platform: state
    entity_id: binary_sensor.den_sliding_door
    to: 'on'
    for:
      minutes: 5
  condition:
    condition: state
    entity_id: binary_sensor.den_window
    state: 'off'
  action:
  - service: tts.google_say
    entity_id: media_player.den_home
    data:
      message: 'Please close the den sliding door'
  - service: notify.chrome
    data:
      message: "Please close the den sliding door"
      target: ["danny_pixel", "tosh_phone"]
      title: Shokabow Zoo

- alias: Check dishwasher
  trigger:
    platform: state
    entity_id: input_boolean.dishes_clean
    to: 'off'
  action:
  - service: tts.google_say
    entity_id: media_player.kitchen_home
    data:
      message: 'Dont forget to check the dishwasher in case the cleaner got off track'

################################################
#
#      Alarm automations and notifications
#
################################################

- alias: Front Door And Living Room Alarm Pic
  trigger:
  - platform: state
    entity_id: binary_sensor.front_door
    to: 'on'
  - platform: state
    entity_id: binary_sensor.living_room_right_bay_window
    to: 'on'
  - platform: state
    entity_id: binary_sensor.living_room_side_window
    to: 'on'
  - platform: state
    entity_id: binary_sensor.living_room_left_bay_window
    to: 'on'
  condition:
    condition: state
    entity_id: alarm_control_panel.home
    state: 'armed_away'
  action:
  - service: switch.turn_on
    entity_id: switch.lr_alarm
  - service: camera.snapshot
    data:
      entity_id: camera.living_room_camera
      filename: '/home/homeassistant/.homeassistant/snapshot/living_room_camera.jpg'
  - service: notify.chrome
    data:
      message: "Alarm Tripped!! Check Slack for living room snapshot"
      target: ["danny_pixel", "tosh_phone"]
      title: Shokabow Zoo
  - service: notify.slack
    data:
      message: "Living room camera snapshot"
      data:
        file:
          path: "/home/homeassistant/.homeassistant/snapshot/living_room_camera.jpg"
  - delay: "00:00:30"
  - service: switch.turn_off
    entity_id: switch.lr_alarm

- alias: Den Alarm Pic
  trigger:
  - platform: state
    entity_id: binary_sensor.den_sliding_door
    to: 'on'
  - platform: state
    entity_id: binary_sensor.den_window
    to: 'on'
  condition:
    condition: state
    entity_id: alarm_control_panel.home
    state: 'armed_away'
  action:
  - service: switch.turn_on
    entity_id: switch.den_alarm
  - service: camera.snapshot
    data:
      entity_id: camera.den_camera
      filename: '/home/homeassistant/.homeassistant/snapshot/den_camera.jpg'
  - service: notify.chrome
    data:
      message: "Alarm Tripped!! Check Slack for den snapshot"
      target: ["danny_pixel", "tosh_phone"]
      title: Shokabow Zoo
  - service: notify.slack
    data:
      message: "Den camera snapshot"
      data:
        file:
          path: "/home/homeassistant/.homeassistant/snapshot/den_camera.jpg"
  - delay: "00:00:30"
  - service: switch.turn_off
    entity_id: switch.den_alarm

- alias: Kitchen Alarm Pic
  trigger:
    platform: state
    entity_id: binary_sensor.kitchen_window
    to: 'on'
  condition:
    condition: state
    entity_id: alarm_control_panel.home
    state: 'armed_away'
  action:
  - service: switch.turn_on
    entity_id: switch.kitchen_alarm
  - service: camera.snapshot
    data:
      entity_id: camera.kitchen_camera
      filename: '/home/homeassistant/.homeassistant/snapshot/kitchen_camera.jpg'
  - service: notify.chrome
    data:
      message: "Alarm Tripped!! Check Slack for kitchen snapshot"
      target: ["danny_pixel", "tosh_phone"]
      title: Shokabow Zoo
  - service: notify.slack
    data:
      message: "Kitchen camera snapshot"
      data:
        file:
          path: "/home/homeassistant/.homeassistant/snapshot/kitchen_camera.jpg"
  - delay: "00:00:30"
  - service: switch.turn_off
    entity_id: switch.kitchen_alarm
    
- alias: Office Alarm Pic
  trigger:
    platform: state
    entity_id: binary_sensor.office_window
    to: 'on'
  condition:
    condition: state
    entity_id: alarm_control_panel.home
    state: 'armed_away'
  action:
  - service: camera.snapshot
    data:
      entity_id: camera.office_camera
      filename: '/home/homeassistant/.homeassistant/snapshot/office_camera.jpg'
  - service: notify.chrome
    data:
      message: "Alarm Tripped!! Check Slack for Office snapshot"
      target: ["danny_pixel", "tosh_phone"]
      title: Shokabow Zoo
  - service: notify.slack
    data:
      message: "Office camera snapshot"
      data:
        file:
          path: "/home/homeassistant/.homeassistant/snapshot/office_camera.jpg"
    
- alias: Alarm Tripped
  trigger:
  - platform: state
    entity_id: binary_sensor.den_sliding_door
    to: 'on'
  - platform: state
    entity_id: binary_sensor.den_window
    to: 'on'
  - platform: state
    entity_id: binary_sensor.front_door
    to: 'on'
  - platform: state
    entity_id: binary_sensor.living_room_right_bay_window
    to: 'on'
  - platform: state
    entity_id: binary_sensor.living_room_side_window
    to: 'on'
  - platform: state
    entity_id: binary_sensor.living_room_left_bay_window
    to: 'on'
  - platform: state
    entity_id: binary_sensor.kitchen_window
    to: 'on'
  - platform: state
    entity_id: binary_sensor.office_window
    to: 'on'
  - platform: state
    entity_id: binary_sensor.bedroom_window
    to: 'on'
  - platform: state
    entity_id: binary_sensor.bathroom_window
    to: 'on'
  - platform: state
    entity_id: binary_sensor.garage_frontyard
    to: 'on'
  - platform: state
    entity_id: sensor.bay_window_shock_alarm_level
    to: '255'
  - platform: state
    entity_id: sensor.bay_window_shock_burglar
    to: '2'
  condition:
    condition: state
    entity_id: alarm_control_panel.home
    state: 'armed_away'
  action:
  - service: alarm_control_panel.alarm_trigger
    entity_id: alarm_control_panel.home
  # - service: notify.chrome
    # data:
      # data:
        # url: !secret living_room_camera_snapshot
      # message: "Alarm Tripped, open to see picture!! {% if is_state('binary_sensor.den_window', 'on') %}Den Window Open{% endif %} {% if is_state('binary_sensor.den_sliding_door', 'on') %}Den Sliding Door Open{% endif %} {% if is_state('binary_sensor.kitchen_window', 'on') %}Kitchen Window Open{% endif %} {% if is_state('binary_sensor.living_room_side_window', 'on') %}Living Room Side Window Open{% endif %} {% if is_state('binary_sensor.living_room_right_bay_window', 'on') %}Living Room Right Bay Window Open{% endif %} {% if is_state('binary_sensor.living_room_left_bay_window', 'on') %}Living Room Left Bay Window Open{% endif %} {% if is_state('binary_sensor.bedroom_window', 'on') %}Bedroom Window Open{% endif %} {% if is_state('binary_sensor.office_window', 'on') %}Office Window Open{% endif %} {% if is_state('binary_sensor.bathroom_window', 'on') %}Bathroom Window Open{% endif %} {% if is_state('binary_sensor.front_door', 'on') %}Front Door Open{% endif %} {% if is_state('binary_sensor.garage_door_frontyard', 'on') %}Garage Door Frontyard Open{% endif %}"
      # target: ["danny_pixel", "tosh_phone"]
      # title: Shokabow Zoo

- alias: Goodbye on Alarm
  trigger:
    platform: state
    entity_id: alarm_control_panel.home
    to: 'armed_away'
  action:
  - service: scene.turn_on
    entity_id: scene.goodbye
  - service: lock.lock
    entity_id: lock.front_door_lock_locked
  - service: notify.chrome
    data:
      message: "The alarm has been activated"
      target: ["danny_pixel", "tosh_phone"]
      title: Shokabow Zoo

- alias: Notify Alarm Off
  trigger:
    platform: state
    entity_id: alarm_control_panel.home
    from: armed_away
    to: disarmed
  action:
  - service: notify.chrome
    data:
      message: "The alarm has been deactivated"
      target: ["danny_pixel", "tosh_phone"]
      title: Shokabow Zoo

- alias: Arm Alarm When Nobody Home
  trigger:
  - entity_id: group.tracked_users
    platform: state
    to: not_home
    for:
      minutes: 3
  condition:
    condition: and
    conditions:
    - condition: state
      entity_id: alarm_control_panel.home
      state: 'disarmed'
    - condition: state
      entity_id: input_boolean.vacation_mode
      state: 'off'
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'
  action:
  - service: alarm_control_panel.alarm_arm_away
    data:
      entity_id: alarm_control_panel.home
  - service: notify.chrome
    data:
      message: "The alarm has been activated since nobody is home"
      target: ["danny_pixel", "tosh_phone"]
      title: Shokabow Zoo

- alias: Disarm alarm when someone comes home
  trigger:
  - platform: state
    entity_id: group.tracked_users
    to: 'home'
  condition:
    condition: state
    entity_id: alarm_control_panel.home
    state: 'armed_away'
  action:
  - service: alarm_control_panel.alarm_disarm
    data:
      entity_id: alarm_control_panel.home
  - service: notify.chrome
    data:
      message: "The alarm has been deactivated since a tracked user is home"
      target: ["danny_pixel", "tosh_phone"]
      title: Shokabow Zoo

- alias: Arm Alarm Front Door
  trigger:
  - platform: state
    entity_id: sensor.front_door_lock_alarm_type
    to: '18'
  condition:
    condition: state
    entity_id: alarm_control_panel.home
    state: 'disarmed'
  action:
  - service: alarm_control_panel.alarm_arm_away
    data:
      entity_id: alarm_control_panel.home

- alias: Disarm Alarm Front Door
  trigger:
  - platform: state
    entity_id: sensor.front_door_lock_alarm_type
    to: '19'
  condition:
    condition: state
    entity_id: alarm_control_panel.home
    state: 'armed_away'
  action:
  - service: alarm_control_panel.alarm_disarm
    data:
      entity_id: alarm_control_panel.home

- alias: Turn on lights if alarm is disarmed and code 1 unlocks
  trigger:
  - platform: state
    entity_id: sensor.front_door_lock_alarm_type
    to: '19'
  condition:
    condition: and
    conditions:
    - condition: state
      entity_id: alarm_control_panel.home
      state: 'disarmed'
    - condition: state
      entity_id: sensor.front_door_lock_alarm_level
      state: '1'
  action:
  - service: light.turn_on
    entity_id: light.living_room_lights_level
  - service: light.turn_on
    entity_id: light.kitchen_lights_level
  - condition: template
    value_template: "{{ states.media_player.kodi_den.state != 'playing' }}"
  - service: light.turn_on
    entity_id: light.den_lights_level

- alias: Dad Unlock
  trigger:
  - platform: state
    entity_id: sensor.front_door_code
    to: 'Dad'
  action:
  - service: light.turn_on
    entity_id: light.office_lights
  - service: notify.chrome
    data:
      message: "The alarm has been deactivated by dad"
      target: ["danny_pixel", "tosh_phone"]
      title: Shokabow Zoo
  - service: tts.google_say
    entity_id: media_player.kitchen_home, media_player.den_home, media_player.office_speaker
    data:
      message: 'Hello just a friendly reminder to make sure the water bowls in the den, living room and also the ferret cage are refilled.  Dont forget to feed the ferrets and cats.  Please clean up the ferrets and cat litter. Thank you so much have a great day.'

- alias: Zookeeper Unlock
  trigger:
  - platform: state
    entity_id: sensor.front_door_code
    to: 'Zoo Keeper'
  action:
  - service: light.turn_on
    entity_id: light.office_lights
  - service: notify.chrome
    data:
      message: "The alarm has been deactivated by zookeper"
      target: ["danny_pixel", "tosh_phone"]
      title: Shokabow Zoo

- alias: Warn Alarm On But Window Open
  trigger:
    platform: state
    entity_id: alarm_control_panel.home
    to: 'armed_away'
  condition:
    condition: state
    entity_id: binary_sensor.windows
    state: 'on'
  action:
  - service: notify.chrome
    data:
      message: "The following window(s) is/are open but the alarm is turned on {% if is_state('binary_sensor.den_window', 'on') %}Den Window Open{% endif %} {% if is_state('binary_sensor.den_sliding_door', 'on') %}Den Sliding Door Open{% endif %} {% if is_state('binary_sensor.kitchen_window', 'on') %}Kitchen Window Open{% endif %} {% if is_state('binary_sensor.living_room_side_window', 'on') %}Living Room Side Window Open{% endif %} {% if is_state('binary_sensor.living_room_right_bay_window', 'on') %}Living Room Right Bay Window Open{% endif %} {% if is_state('binary_sensor.living_room_left_bay_window', 'on') %}Living Room Left Bay Window Open{% endif %} {% if is_state('binary_sensor.bedroom_window', 'on') %}Bedroom Window Open{% endif %} {% if is_state('binary_sensor.office_window', 'on') %}Office Window Open{% endif %} {% if is_state('binary_sensor.bathroom_window', 'on') %}Bathroom Window Open{% endif %} {% if is_state('binary_sensor.front_door', 'on') %}Front Door Open{% endif %} {% if is_state('binary_sensor.garage_door_frontyard', 'on') %}Garage Door Frontyard Open{% endif %}"
      target: ["danny_pixel", "tosh_phone"]
      title: Shokabow Zoo
      
- alias: Notify door lock keypad locked
  trigger:
    platform: state
    entity_id: sensor.front_door_lock_alarm_type
    to: '161'
  action:
  - service: notify.chrome
    data:
      message: "Too many incorrect codes used on front door.  Keypad locked."
      target: ["danny_pixel", "tosh_phone"]
      title: Shokabow Zoo

- alias: Notify alarm triggered
  trigger:
    platform: state
    entity_id: alarm_control_panel.home
    to: 'triggered'
  action:
  - service: light.turn_on
    entity_id: light.den_lights_level, light.kitchen_lights_level, light.living_room_lights_level, light.bedroom_lights_level, light.office_lights
  - service: notify.chrome
    data:
      image: !secret living_room_camera_snapshot
      message: "The alarm has been triggered since it was not disarmed for 60 seconds, check Slack for snapshots!! Following windows/doors triggered the alarm {% if is_state('binary_sensor.den_window', 'on') %}Den Window Open{% endif %} {% if is_state('binary_sensor.den_sliding_door', 'on') %}Den Sliding Door Open{% endif %} {% if is_state('binary_sensor.kitchen_window', 'on') %}Kitchen Window Open{% endif %} {% if is_state('binary_sensor.living_room_side_window', 'on') %}Living Room Side Window Open{% endif %} {% if is_state('binary_sensor.living_room_right_bay_window', 'on') %}Living Room Right Bay Window Open{% endif %} {% if is_state('binary_sensor.living_room_left_bay_window', 'on') %}Living Room Left Bay Window Open{% endif %} {% if is_state('binary_sensor.bedroom_window', 'on') %}Bedroom Window Open{% endif %} {% if is_state('binary_sensor.office_window', 'on') %}Office Window Open{% endif %} {% if is_state('binary_sensor.bathroom_window', 'on') %}Bathroom Window Open{% endif %} {% if is_state('binary_sensor.front_door', 'on') %}Front Door Open{% endif %} {% if is_state('binary_sensor.garage_door_frontyard', 'on') %}Garage Door Frontyard Open{% endif %}"
      target: ["danny_pixel", "tosh_phone"]
      title: Shokabow Zoo
  - service: switch.turn_on
    entity_id: switch.siren_switch
  - service: script.turn_on
    entity_id: script.den_camera_snapshot
  - service: script.turn_on
    entity_id: script.living_room_camera_snapshot
  - service: script.turn_on
    entity_id: script.kitchen_camera_snapshot, script.office_camera_snapshot
  - service: script.turn_on
    entity_id: script.outdoor_camera_snapshot
  - service: script.turn_on
    entity_id: script.den_alarm, script.lr_alarm, script.kitchen_alarm
  - condition: state
    entity_id: sun.sun
    state: below_horizon
  - service: light.turn_on
    entity_id: light.patio

- alias: Turn off armed night when we wake up
  trigger:
  - platform: state
    entity_id: switch.tasker_sleep_tosh
    from: 'on'
    to: 'off'
  - platform: state
    entity_id: switch.tasker_sleep_danny
    from: 'on'
    to: 'off'
  condition:
    condition: state
    entity_id: alarm_control_panel.home
    state: 'armed_night'
  action:
  - service: alarm_control_panel.alarm_disarm
    entity_id: alarm_control_panel.home
  - service: input_boolean.turn_off
    entity_id: input_boolean.night_mode

- alias: Turn on alarm night in night mode
  trigger:
    platform: state
    entity_id: input_boolean.night_mode
    to: 'on'
  action:
  - service: alarm_control_panel.alarm_arm_night
    entity_id: alarm_control_panel.home
    
- alias: Alarm Tripped in armed night
  trigger:
  - platform: state
    entity_id: binary_sensor.den_window
    to: 'on'
  - platform: state
    entity_id: binary_sensor.living_room_right_bay_window
    to: 'on'
  - platform: state
    entity_id: binary_sensor.living_room_side_window
    to: 'on'
  - platform: state
    entity_id: binary_sensor.living_room_left_bay_window
    to: 'on'
  - platform: state
    entity_id: binary_sensor.kitchen_window
    to: 'on'
  - platform: state
    entity_id: binary_sensor.office_window
    to: 'on'
  - platform: state
    entity_id: binary_sensor.bedroom_window
    to: 'on'
  - platform: state
    entity_id: binary_sensor.bathroom_window
    to: 'on'
  - platform: state
    entity_id: binary_sensor.garage_frontyard
    to: 'on'
  - platform: state
    entity_id: sensor.bay_window_shock_alarm_level
    to: '255'
  - platform: state
    entity_id: sensor.bay_window_shock_burglar
    to: '2'
  condition:
    condition: state
    entity_id: alarm_control_panel.home
    state: 'armed_night'
  action:
  - service: notify.chrome
    data:
      message: "Alarm is in armed night and {% if is_state('binary_sensor.den_window', 'on') %}Den Window Open{% endif %} {% if is_state('binary_sensor.den_sliding_door', 'on') %}Den Sliding Door Open{% endif %} {% if is_state('binary_sensor.kitchen_window', 'on') %}Kitchen Window Open{% endif %} {% if is_state('binary_sensor.living_room_side_window', 'on') %}Living Room Side Window Open{% endif %} {% if is_state('binary_sensor.living_room_right_bay_window', 'on') %}Living Room Right Bay Window Open{% endif %} {% if is_state('binary_sensor.living_room_left_bay_window', 'on') %}Living Room Left Bay Window Open{% endif %} {% if is_state('binary_sensor.bedroom_window', 'on') %}Bedroom Window Open{% endif %} {% if is_state('binary_sensor.office_window', 'on') %}Office Window Open{% endif %} {% if is_state('binary_sensor.bathroom_window', 'on') %}Bathroom Window Open{% endif %} {% if is_state('binary_sensor.front_door', 'on') %}Front Door Open{% endif %} {% if is_state('binary_sensor.garage_door_frontyard', 'on') %}Garage Door Frontyard Open{% endif %}"
      target: ["danny_pixel", "tosh_phone"]
      title: Shokabow Zoo
  - service: tts.google_say
    entity_id: media_player.bedroom_speaker
    data_template:
      message: "Alarm is in armed night and {% if is_state('binary_sensor.den_window', 'on') %}Den Window Open{% endif %} {% if is_state('binary_sensor.den_sliding_door', 'on') %}Den Sliding Door Open{% endif %} {% if is_state('binary_sensor.kitchen_window', 'on') %}Kitchen Window Open{% endif %} {% if is_state('binary_sensor.living_room_side_window', 'on') %}Living Room Side Window Open{% endif %} {% if is_state('binary_sensor.living_room_right_bay_window', 'on') %}Living Room Right Bay Window Open{% endif %} {% if is_state('binary_sensor.living_room_left_bay_window', 'on') %}Living Room Left Bay Window Open{% endif %} {% if is_state('binary_sensor.bedroom_window', 'on') %}Bedroom Window Open{% endif %} {% if is_state('binary_sensor.office_window', 'on') %}Office Window Open{% endif %} {% if is_state('binary_sensor.bathroom_window', 'on') %}Bathroom Window Open{% endif %} {% if is_state('binary_sensor.front_door', 'on') %}Front Door Open{% endif %} {% if is_state('binary_sensor.garage_door_frontyard', 'on') %}Garage Door Frontyard Open{% endif %}"

- alias: Windows open while going to bed
  trigger:
  - platform: state
    entity_id: binary_sensor.den_window
    to: 'on'
  - platform: state
    entity_id: binary_sensor.living_room_right_bay_window
    to: 'on'
  - platform: state
    entity_id: binary_sensor.living_room_side_window
    to: 'on'
  - platform: state
    entity_id: binary_sensor.living_room_left_bay_window
    to: 'on'
  - platform: state
    entity_id: binary_sensor.kitchen_window
    to: 'on'
  - platform: state
    entity_id: binary_sensor.office_window
    to: 'on'
  - platform: state
    entity_id: binary_sensor.bedroom_window
    to: 'on'
  - platform: state
    entity_id: binary_sensor.bathroom_window
    to: 'on'
  - platform: state
    entity_id: binary_sensor.windows
    to: 'on'
  condition:
    condition: and
    conditions:
    - condition: state
      entity_id: binary_sensor.windows
      state: 'on'
    - condition: state
      entity_id: input_boolean.night_mode
      state: 'on'
  action:
  - service: notify.chrome
    data_template:
      message: "The alarm is arming in night mode and {% if is_state('binary_sensor.den_window', 'on') %}Den Window Open{% endif %} {% if is_state('binary_sensor.kitchen_window', 'on') %}Kitchen Window Open{% endif %} {% if is_state('binary_sensor.living_room_side_window', 'on') %}Living Room Side Window Open{% endif %} {% if is_state('binary_sensor.living_room_right_bay_window', 'on') %}Living Room Right Bay Window Open{% endif %} {% if is_state('binary_sensor.living_room_left_bay_window', 'on') %}Living Room Left Bay Window Open{% endif %} {% if is_state('binary_sensor.bedroom_window', 'on') %}Bedroom Window Open{% endif %} {% if is_state('binary_sensor.office_window', 'on') %}Office Window Open{% endif %} {% if is_state('binary_sensor.bathroom_window', 'on') %}Bathroom Window Open{% endif %}"
      target: ["danny_pixel", "tosh_phone"]
      title: Shokabow Zoo
  - condition: state
    entity_id: group.tracked_users
    state: 'home'
  - service: tts.google_say
    #entity_id: media_player.home_notification
    entity_id: media_player.bedroom_speaker
    data_template:
      message: "The alarm is arming in night mode and {% if is_state('binary_sensor.den_window', 'on') %}Den Window Open{% endif %} {% if is_state('binary_sensor.kitchen_window', 'on') %}Kitchen Window Open{% endif %} {% if is_state('binary_sensor.living_room_side_window', 'on') %}Living Room Side Window Open{% endif %} {% if is_state('binary_sensor.living_room_right_bay_window', 'on') %}Living Room Right Bay Window Open{% endif %} {% if is_state('binary_sensor.living_room_left_bay_window', 'on') %}Living Room Left Bay Window Open{% endif %} {% if is_state('binary_sensor.bedroom_window', 'on') %}Bedroom Window Open{% endif %} {% if is_state('binary_sensor.office_window', 'on') %}Office Window Open{% endif %} {% if is_state('binary_sensor.bathroom_window', 'on') %}Bathroom Window Open{% endif %}"

- alias: Set alarm status drop down
  trigger:
  - platform: state
    entity_id: alarm_control_panel.home
    to: 'disarmed'
  - platform: state
    entity_id: alarm_control_panel.home
    to: 'armed_away'
  - platform: state
    entity_id: alarm_control_panel.home
    to: 'armed_night'
  action:
  - service: input_select.select_option
    entity_id: input_select.alarm_status
    data_template:
      option: >
        {% if is_state("alarm_control_panel.home", "disarmed") %}
          Disarmed
        {% elif is_state("alarm_control_panel.home", "armed_away") %}
          Armed Away
        {% elif is_state("alarm_control_panel.home", "armed_night") %}
          Armed Night
        {% else %}
        {% endif %}

    
################################################
#
#      Office automation
#
################################################

- alias: Office Lights On
  trigger:
    platform: state
    entity_id: light.office_lights
    to: 'on'
  action:
  - service: light.turn_on
    entity_id: light.o1
    data:
      brightness_pct: 100
  - service: light.turn_on
    entity_id: light.o2
    data:
      brightness_pct: 100
  - service: light.turn_on
    entity_id: light.o3
    data:
      brightness_pct: 100
  - service: light.turn_on
    entity_id: light.o4
    data:
      brightness_pct: 100
  - service: light.turn_on
    entity_id: light.office_lights
    data:
      brightness_pct: 100

- alias: Office Lights Off
  trigger:
    platform: state
    entity_id: light.office_lights
    to: 'off'
  action:
  - service: light.turn_off
    entity_id: light.o1
  - service: light.turn_off
    entity_id: light.o2
  - service: light.turn_off
    entity_id: light.o3
  - service: light.turn_off
    entity_id: light.o4

################################################
#
#      Dog Lights
#
################################################

- alias: Dog Lights On
  trigger:
  - platform: state
    entity_id: alarm_control_panel.home
    to: 'armed_away'
  - platform: sun
    event: sunset
    offset: "00:01:00"
  condition:
    condition: and
    conditions:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: alarm_control_panel.home
      state: 'armed_away'
  action:
  - service: light.turn_on
    entity_id: light.front_door_lamp
  - service: light.turn_on
    entity_id: light.corner_lamp
    data:
      kelvin: 2703
      brightness_pct: 100

- alias: Dog Lights Off
  trigger:
  - platform: sun
    event: sunrise
  - platform: state
    entity_id: alarm_control_panel.home
    from: 'armed_away'
    to: 'disarmed'
  action:
  - service: light.turn_off
    entity_id: light.corner_lamp, light.front_door_lamp

################################################
#
#      Morning Automations
#
################################################

- alias: Boogie Morning Rule
  trigger:
  - platform: time
    at: "07:15:00"
  condition:
    condition: and
    conditions:
    - condition: time
      weekday:
      - mon
      - tue
      - wed
      - thu
      - fri
    - condition: state
      entity_id: input_boolean.vacation_mode
      state: 'off'
    - condition: or
      conditions:
      - condition: state
        entity_id: alarm_control_panel.home
        state: 'disarmed'
      - condition: state
        entity_id: alarm_control_panel.home
        state: 'armed_night'
  action:
  - service: light.turn_on
    entity_id: light.office_lights
  - service: light.turn_on
    entity_id: light.kitchen_lights_level, light.living_room_lights_level, light.den_lights_level
  - service: light.turn_on
    entity_id: light.bedroom_lights_level
  - service: script.turn_on
    entity_id: script.open_bedroom_curtains
  - service: switch.turn_off
    entity_id: switch.bedroom_fan
  - wait_template: "{{ states.binary_sensor.natachas_bayesian_presence.state == 'off' }}"
  - service: light.turn_off
    entity_id: light.office_lights
  - service: light.turn_off
    entity_id: light.kitchen_lights_level
  - service: light.turn_off
    entity_id: light.living_room_lights_level
  - service: light.turn_off
    entity_id: light.bedroom_lights_level
  - condition: state
    entity_id: binary_sensor.bedroom_door
    state: 'on'
  - service: notify.den
    data_template:
      data:
        color: red
        duration: 10
        position: center
      message: 'Bedroom door left open and boogie has left for work, go close it!'
      title: Shokabow Zoo
  - service: notify.chrome
    data_template:
      message: "Bedroom door left open and boogie has left for work, go close it!"
      target: danny_pixel
      title: Shokabow Zoo
  - service: tts.google_say
    entity_id: media_player.den_home
    data:
      message: "Bedroom door left open and boogie has left for work, go close it!"

- alias: Boogie Take Your Meds
  trigger:
  - platform: time
    at: "08:00:00"
  condition:
    condition: and
    conditions:
    - condition: time
      weekday:
      - mon
      - tue
      - wed
      - thu
      - fri
    - condition: state
      entity_id: input_boolean.vacation_mode
      state: 'off'
    - condition: or
      conditions:
      - condition: state
        entity_id: alarm_control_panel.home
        state: 'disarmed'
      - condition: state
        entity_id: alarm_control_panel.home
        state: 'armed_night'
  action:
  - service: tts.google_say
    entity_id: media_player.kitchen_home
    data:
      message: "Don't forget to take your meds"

- alias: Good Morning
  trigger:
  - platform: sun
    event: sunrise
  condition:
    condition: or
    conditions:
    - condition: state
      entity_id: alarm_control_panel.home
      state: 'disarmed'
    - condition: state
      entity_id: alarm_control_panel.home
      state: 'armed_night'
  action:
  - service: script.turn_on
    entity_id: script.open_bay_window_curtains
  - service: switch.turn_off
    entity_id: switch.house_fan
  - service: light.turn_off
    entity_id: light.bathroom_night_light

- alias: Hallway light above horizon
  trigger:
  - platform: state
    entity_id: light.hallway_light
    to: 'on'
  condition:
    condition: state
    entity_id: sun.sun
    state: 'above_horizon'
  action:
  - service: light.turn_on
    entity_id: light.hallway_light
    data:
      kelvin: 6500
      brightness_pct: 100

- alias: Bedroom curtains on weekends
  trigger:
  - platform: time
    at: "10:30:00"
  condition:
    condition: and
    conditions:
    - condition: state
      entity_id: input_boolean.bedroom_curtains
      state: 'off'
    - condition: time
      weekday:
      - sat
      - sun
    - condition: or
      conditions:
      - condition: state
        entity_id: alarm_control_panel.home
        state: 'disarmed'
      - condition: state
        entity_id: alarm_control_panel.home
        state: 'armed_night'
  action:
  - service: script.turn_on
    entity_id: script.open_bedroom_curtains

- alias: Heat up house in morning on work days
  trigger:
  - platform: time
    at: "07:15:00"
  condition:
    condition: and
    conditions:
    - condition: time
      weekday:
      - mon
      - tue
      - wed
      - thu
      - fri
    - condition: template
      value_template: "{{ states.climate.thermostat_heating_1.attributes.current_temperature <= 65 }}"
    - condition: state
      entity_id: input_boolean.vacation_mode
      state: 'off'
    - condition: or
      conditions:
      - condition: state
        entity_id: alarm_control_panel.home
        state: 'disarmed'
      - condition: state
        entity_id: alarm_control_panel.home
        state: 'armed_night'
  action:
  - service: climate.set_temperature
    data:
      entity_id: climate.thermostat_heating_1
      #operation_mode: Heat
      temperature: 70
  - service: climate.set_operation_mode
    data:
      entity_id: climate.thermostat_heating_1
      operation_mode: 'Heat'

- alias: Den lights on between 4 and 8am
  trigger:
    platform: state
    entity_id: light.den_lights_level
    to: 'on'
  condition:
    condition: time
    after: "04:00:00"
    before: "08:00:00"
  action:
    service: light.turn_on
    entity_id: light.den_lights_level
    data:
      brightness_pct: 5
      
- alias: Raise den lights at 9am if below 30
  trigger:
    platform: time
    at: "09:00:00"
  condition:
    condition: and
    conditions:
    - condition: state
      entity_id: light.den_lights_level
      state: 'on'
    - condition: template
      value_template: "{{ states.light.den_lights_level.attributes.brightness < 75 }}"
  action:
    service: light.turn_on
    entity_id: light.den_lights_level
    data:
      brightness_pct: 30
      
- alias: Danny awake
  trigger:
    platform: state
    entity_id: switch.tasker_sleep_danny
    from: 'on'
    to: 'off'
  action:
  - service: light.turn_on
    entity_id: light.den_lights_level
    
################################################
#
#      Lock Automations
#
################################################

- alias: Timer Start Auto Lock
  trigger:
  - platform: state
    entity_id: lock.front_door_lock_locked
    to: 'unlocked'
  - platform: state
    entity_id: binary_sensor.front_door
    to: 'off'
  condition:
    condition: and
    conditions:
    - condition: state
      entity_id: binary_sensor.front_door
      state: 'off'
    - condition: state
      entity_id: lock.front_door_lock_locked
      state: 'unlocked'
  action:
  - service: timer.start
    entity_id: timer.door_lock

- alias: Cancel Timer Door Locked
  trigger:
  - platform: state
    entity_id: lock.front_door_lock_locked
    to: 'locked'
  - platform: state
    entity_id: binary_sensor.front_door
    to: 'on'
  action:
  - service: timer.cancel
    entity_id: timer.door_lock

- alias: Auto Lock Front Door
  trigger:
  - platform: event
    event_type: timer.finished
    event_data:
      entity_id: timer.door_lock
  condition:
    condition: state
    entity_id: binary_sensor.front_door
    state: 'off'
  action:
  - service: lock.lock
    entity_id: lock.front_door_lock_locked

################################################
#
#      Mailbox notification
#
################################################

- alias: Enable mailbox boolean
  trigger:
  - platform: sun
    event: sunrise
  action:
    service: input_boolean.turn_on
    entity_id: input_boolean.mailbox

- alias: Turn off mailbox boolean after it was opened
  trigger:
  - platform: state
    entity_id: binary_sensor.mailbox
    to: 'on'
  action:
    service: input_boolean.turn_off
    entity_id: input_boolean.mailbox

- alias: Notify Mail Once
  trigger:
  - platform: state
    entity_id: input_boolean.mailbox
    to: 'off'
  condition:
    condition: state
    entity_id: alarm_control_panel.home
    state: 'disarmed'
  action:
  - service: notify.chrome
    data:
      message: "You got mail"
      target: danny_pixel
      title: Shokabow Zoo
  - condition: state
    entity_id: group.tracked_users
    state: 'home'
  - service: tts.google_say
    #entity_id: media_player.home_notification
    #entity_id: media_player.den_home, media_player.kitchen_home, media_player.bedroom_speaker, media_player.office_speaker, media_player.bathroom_speaker, media_player.living_room_home
    data_template:
      message: 'You got mail'
      entity_id: >
        {% if states.media_player.home_notification.state != 'unavailable' %}
          media_player.home_notification
        {% else %}
          media_player.den_home, media_player.kitchen_home, media_player.bedroom_speaker, media_player.office_speaker, media_player.bathroom_speaker, media_player.living_room_home
        {%endif %}
  - service: notify.den
    data:
      data:
        color: teal
      message: You got mail!
      title: Shokabow Zoo

- alias: Mailbox boolean hass restart
  trigger:
    platform: homeassistant
    event: start
  condition:
    condition: time
    before: '11:00:00'
  action:
  - service: input_boolean.turn_on
    entity_id: input_boolean.mailbox

################################################
#
#      Basic Light Automations
#
################################################

- alias: Bedroom closet light
  trigger:
  - platform: state
    entity_id: binary_sensor.bedroom_closet_door
    to: 'on'
  - platform: state
    entity_id: binary_sensor.bedroom_closet_door
    to: 'off'
  action:
    service_template: >
           {% if is_state("binary_sensor.bedroom_closet_door", "on") %}
             light.turn_on
           {% elif is_state("binary_sensor.bedroom_closet_door", "off") %}
             light.turn_off
           {% else %}
           {% endif %}
    entity_id: light.bedroom_closet

- alias: Turn off bedroom closet if on for 15 min and door closed
  trigger:
  - platform: state
    entity_id: light.bedroom_closet
    to: 'on'
    for:
      minutes: 15
  condition:
    condition: state
    entity_id: binary_sensor.bedroom_closet_door
    state: 'off'
  action:
    service: light.turn_off
    entity_id: light.bedroom_closet

- alias: Turn off office closet if on for 15 min and door closed
  trigger:
  - platform: state
    entity_id: light.office_closet
    to: 'on'
    for:
      minutes: 15
  condition:
    condition: state
    entity_id: binary_sensor.office_closet_door
    state: 'off'
  action:
    service: light.turn_off
    entity_id: light.office_closet
    
- alias: Office Closet Light
  trigger:
  - platform: state
    entity_id: binary_sensor.office_closet_door
    to: 'on'
  - platform: state
    entity_id: binary_sensor.office_closet_door
    to: 'off'
  action:
    service_template: >
           {% if is_state("binary_sensor.office_closet_door", "on") %}
             light.turn_on
           {% elif is_state("binary_sensor.office_closet_door", "off") %}
             light.turn_off
           {% else %}
           {% endif %}
    entity_id: light.office_closet

- alias: Garage lights from frontyard
  trigger:
  - platform: state
    entity_id: binary_sensor.garage_frontyard
    to: 'on'
  - platform: state
    entity_id: binary_sensor.garage_frontyard
    to: 'off'
  action:
    service_template: >
           {% if is_state("binary_sensor.garage_frontyard", "on") %}
             switch.turn_on
           {% elif is_state("binary_sensor.garage_frontyard", "off") %}
             switch.turn_off
           {% else %}
           {% endif %}
    entity_id: switch.garage_lights_switch

- alias: Turn on garage lights from backyard
  trigger:
  - platform: state
    entity_id: binary_sensor.garage_backyard_door
    to: 'on'
  action:
    service: switch.turn_on
    entity_id: switch.garage_lights_switch

- alias: Turn off garage lights from backyard
  trigger:
  - platform: state
    entity_id: binary_sensor.garage_backyard_door
    to: 'off'
  condition:
    condition: state
    entity_id: binary_sensor.garage_frontyard
    state: 'off'
  action:
  - service: switch.turn_off
    entity_id: switch.garage_lights_switch

- alias: Turn off garage lights if backyard left open for 15 minutes
  trigger:
  - platform: state
    entity_id: binary_sensor.garage_backyard_door
    to: 'on'
    for:
      minutes: 15
  - platform: state
    entity_id: switch.garage_lights_switch
    to: 'on'
    for:
      minutes: 15
  condition:
    condition: state
    entity_id: binary_sensor.garage_frontyard
    state: 'off'
  action:
  - service: switch.turn_off
    entity_id: switch.garage_lights_switch

################################################
#
#      Rain and Windows Open
#
################################################

- alias: Rain and Windows Open
  trigger:
  - platform: state
    entity_id: binary_sensor.shokabow_weather_rain
    to: 'on'
  - platform: state
    entity_id: binary_sensor.den_window
    to: 'on'
  - platform: state
    entity_id: binary_sensor.living_room_right_bay_window
    to: 'on'
  - platform: state
    entity_id: binary_sensor.living_room_side_window
    to: 'on'
  - platform: state
    entity_id: binary_sensor.living_room_left_bay_window
    to: 'on'
  - platform: state
    entity_id: binary_sensor.kitchen_window
    to: 'on'
  - platform: state
    entity_id: binary_sensor.office_window
    to: 'on'
  - platform: state
    entity_id: binary_sensor.bedroom_window
    to: 'on'
  - platform: state
    entity_id: binary_sensor.bathroom_window
    to: 'on'
  condition:
    condition: and
    conditions:
    - condition: state
      entity_id: input_boolean.rachio
      state: 'off'
    - condition: state
      entity_id: binary_sensor.windows
      state: 'on'
    - condition: state
      entity_id: binary_sensor.shokabow_weather_rain
      state: 'on'
    - condition: state
      entity_id: input_boolean.night_mode
      state: 'off'
  action:
  - service: notify.chrome
    data_template:
      message: "It's raining and {% if is_state('binary_sensor.den_window', 'on') %}Den Window Open{% endif %} {% if is_state('binary_sensor.kitchen_window', 'on') %}Kitchen Window Open{% endif %} {% if is_state('binary_sensor.living_room_side_window', 'on') %}Living Room Side Window Open{% endif %} {% if is_state('binary_sensor.living_room_right_bay_window', 'on') %}Living Room Right Bay Window Open{% endif %} {% if is_state('binary_sensor.living_room_left_bay_window', 'on') %}Living Room Left Bay Window Open{% endif %} {% if is_state('binary_sensor.bedroom_window', 'on') %}Bedroom Window Open{% endif %} {% if is_state('binary_sensor.office_window', 'on') %}Office Window Open{% endif %} {% if is_state('binary_sensor.bathroom_window', 'on') %}Bathroom Window Open{% endif %}"
      target: danny_pixel
      title: Shokabow Zoo
  - condition: state
    entity_id: group.tracked_users
    state: 'home'
  - service: tts.google_say
    #entity_id: media_player.home_notification
    #entity_id: media_player.den_home, media_player.kitchen_home, media_player.bedroom_speaker, media_player.office_speaker, media_player.bathroom_speaker, media_player.living_room_home
    data_template:
      message: "Its raining and {% if is_state('binary_sensor.den_window', 'on') %}Den Window Open{% endif %} {% if is_state('binary_sensor.kitchen_window', 'on') %}Kitchen Window Open{% endif %} {% if is_state('binary_sensor.living_room_side_window', 'on') %}Living Room Side Window Open{% endif %} {% if is_state('binary_sensor.living_room_right_bay_window', 'on') %}Living Room Right Bay Window Open{% endif %} {% if is_state('binary_sensor.living_room_left_bay_window', 'on') %}Living Room Left Bay Window Open{% endif %} {% if is_state('binary_sensor.bedroom_window', 'on') %}Bedroom Window Open{% endif %} {% if is_state('binary_sensor.office_window', 'on') %}Office Window Open{% endif %} {% if is_state('binary_sensor.bathroom_window', 'on') %}Bathroom Window Open{% endif %}"
      entity_id: >
        {% if states.media_player.home_notification.state != 'unavailable' %}
          media_player.home_notification
        {% else %}
          media_player.den_home, media_player.kitchen_home, media_player.bedroom_speaker, media_player.office_speaker, media_player.bathroom_speaker, media_player.living_room_home
        {%endif %}
        
- alias: Thermostat on and window open
  trigger:
  - platform: state
    entity_id: binary_sensor.den_window
    to: 'on'
  - platform: state
    entity_id: binary_sensor.living_room_right_bay_window
    to: 'on'
  - platform: state
    entity_id: binary_sensor.living_room_side_window
    to: 'on'
  - platform: state
    entity_id: binary_sensor.living_room_left_bay_window
    to: 'on'
  - platform: state
    entity_id: binary_sensor.kitchen_window
    to: 'on'
  - platform: state
    entity_id: binary_sensor.office_window
    to: 'on'
  - platform: state
    entity_id: binary_sensor.bedroom_window
    to: 'on'
  - platform: state
    entity_id: binary_sensor.bathroom_window
    to: 'on'
  - platform: template
    value_template: "{{ states.climate.thermostat_heating_1.attributes.operation_mode != 'Off' }}"
  condition:
    condition: and
    conditions:
    - condition: state
      entity_id: binary_sensor.windows
      state: 'on'
    - condition: template
      value_template: "{{ states.climate.thermostat_heating_1.attributes.operation_mode != 'Off' }}"
    - condition: state
      entity_id: input_boolean.night_mode
      state: 'off'
    - condition: state
      entity_id: input_boolean.shower_mode
      state: 'off'
  action:
  - service: notify.chrome
    data_template:
      message: "The thermostat is on and {% if is_state('binary_sensor.den_window', 'on') %}Den Window Open{% endif %} {% if is_state('binary_sensor.kitchen_window', 'on') %}Kitchen Window Open{% endif %} {% if is_state('binary_sensor.living_room_side_window', 'on') %}Living Room Side Window Open{% endif %} {% if is_state('binary_sensor.living_room_right_bay_window', 'on') %}Living Room Right Bay Window Open{% endif %} {% if is_state('binary_sensor.living_room_left_bay_window', 'on') %}Living Room Left Bay Window Open{% endif %} {% if is_state('binary_sensor.bedroom_window', 'on') %}Bedroom Window Open{% endif %} {% if is_state('binary_sensor.office_window', 'on') %}Office Window Open{% endif %} {% if is_state('binary_sensor.bathroom_window', 'on') %}Bathroom Window Open{% endif %}"
      target: danny_pixel
      title: Shokabow Zoo
  - condition: state
    entity_id: group.tracked_users
    state: 'home'
  - service: tts.google_say
    #entity_id: media_player.home_notification
    #entity_id: media_player.den_home, media_player.kitchen_home, media_player.bedroom_speaker, media_player.office_speaker, media_player.bathroom_speaker, media_player.living_room_home
    data_template:
      message: "The thermostat is on and {% if is_state('binary_sensor.den_window', 'on') %}Den Window Open{% endif %} {% if is_state('binary_sensor.kitchen_window', 'on') %}Kitchen Window Open{% endif %} {% if is_state('binary_sensor.living_room_side_window', 'on') %}Living Room Side Window Open{% endif %} {% if is_state('binary_sensor.living_room_right_bay_window', 'on') %}Living Room Right Bay Window Open{% endif %} {% if is_state('binary_sensor.living_room_left_bay_window', 'on') %}Living Room Left Bay Window Open{% endif %} {% if is_state('binary_sensor.bedroom_window', 'on') %}Bedroom Window Open{% endif %} {% if is_state('binary_sensor.office_window', 'on') %}Office Window Open{% endif %} {% if is_state('binary_sensor.bathroom_window', 'on') %}Bathroom Window Open{% endif %}"
      entity_id: >
        {% if states.media_player.home_notification.state != 'unavailable' %}
          media_player.home_notification
        {% else %}
          media_player.den_home, media_player.kitchen_home, media_player.bedroom_speaker, media_player.office_speaker, media_player.bathroom_speaker, media_player.living_room_home
        {%endif %}
################################################
#
#      Night time automations
#
################################################   

- alias: Colorful at night
  trigger:
  - platform: sun
    event: sunset
    offset: "00:01:00"
  - platform: state
    entity_id: alarm_control_panel.home
    from: 'armed_away'
    to: 'disarmed'
  condition:
    condition: and
    conditions:
    - condition: state
      entity_id: alarm_control_panel.home
      state: 'disarmed'
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
  action:
  - service: scene.turn_on
    entity_id: scene.colorful

- alias: Turn off fan if house is cold
  trigger:
  - platform: template
    value_template: "{{ states.climate.thermostat_heating_1.attributes.current_temperature <= 65 }}"
  condition:
    condition: state
    entity_id: switch.bedroom_fan
    state: 'on'
  action:
  - service: switch.turn_off
    entity_id: switch.bedroom_fan
  - condition: state
    entity_id: switch.house_fan
    state: 'on'
  - service: switch.turn_off
    entity_id: switch.house_fan

- alias: Turn on sleep tracking on our phones
  trigger:
    platform: state
    entity_id: input_boolean.night_mode
    to: 'on'
  action:
  - service: switch.turn_on
    entity_id: switch.tasker_sleep_danny, switch.tasker_sleep_tosh
    
- alias: Turn off thermostat if left on during night mode
  trigger:
  - platform: state
    entity_id: input_boolean.night_mode
    to: 'on'
  - platform: state
    entity_id: climate.thermostat_cooling_1
    to: 'Cool'
  condition:
    condition: and
    conditions:
    - condition: state
      entity_id: input_boolean.night_mode
      state: 'on'
    - condition: state
      entity_id: climate.thermostat_cooling_1
      state: 'Cool'
  action:
  - delay: "00:01:00"
  - wait_template: "{{ states.climate.thermostat_cooling_1.attributes.current_temperature == states.climate.thermostat_cooling_1.attributes.temperature }}"
  - service: climate.set_operation_mode
    data:
      entity_id: climate.thermostat_cooling_1
      operation_mode: 'Off'
    
##################################################
#
#      Lights Alarm Off
#
################################################

- alias: Lights On When Alarm Off
  trigger:
  - platform: state
    entity_id: alarm_control_panel.home
    from: 'armed_away'
    to: 'disarmed'
  action:
  - service: light.turn_on
    entity_id: light.den_lights_level
  - service: light.turn_on
    entity_id: light.kitchen_lights_level
  - service: light.turn_on
    entity_id: light.living_room_lights_level
  - service: switch.turn_off
    entity_id: switch.siren_switch

################################################
#
#      Smoke Notifications
#
################################################

- alias: Smoke Detected
  trigger:
  - platform: state
    entity_id: sensor.den_smoke_status
    to: 'Fire'
  - platform: state
    entity_id: sensor.bedroom_smoke_status
    to: 'Fire'
  - platform: state
    entity_id: sensor.office_smoke_status
    to: 'Fire'
  action:
  - service: notify.den
    data_template:
      data:
        color: red
        duration: 10
        position: center
      message: 'Smoke Detected! {{ trigger.to_state.attributes.friendly_name }}'
      title: Shokabow Zoo
  - service: notify.chrome
    data_template:
      message: "Smoke Detected {{ trigger.to_state.attributes.friendly_name }}"
      target: ["danny_pixel", "tosh_phone"]
      title: Shokabow Zoo
  - service: notify.slack
    data_template:
      message: "Smoke detected at home  {{ trigger.to_state.attributes.friendly_name }}"

- alias: CO2 Detected
  trigger:
  - platform: state
    entity_id: sensor.den_smoke_status
    to: 'CO2'
  - platform: state
    entity_id: sensor.bedroom_smoke_status
    to: 'CO2'
  - platform: state
    entity_id: sensor.office_smoke_status
    to: 'CO2'
  action:
  - service: notify.den
    data_template:
      data:
        color: red
        duration: 10
        position: center
      message: 'CO2 Detected! {{ trigger.to_state.attributes.friendly_name }}'
      title: Shokabow Zoo
  - service: notify.chrome
    data_template:
      message: "CO2 Detected  {{ trigger.to_state.attributes.friendly_name }}"
      target: ["danny_pixel", "tosh_phone"]
      title: Shokabow Zoo
  - service: notify.slack
    data_template:
      message: "CO2 detected at home {{ trigger.to_state.attributes.friendly_name }}"

################################################
#
#      Cast Automations
#
################################################

- alias: Stop Playing When Input Select Is Off
  trigger:
  - platform: state
    entity_id: input_select.radio_station
    to: "None"
  action:
  - service: media_player.turn_off
    data_template:
      entity_id: >
              {% if is_state("input_select.streaming_audio", "Living Room") %}
                media_player.living_room_home
              {%-elif is_state("input_select.streaming_audio", "Whole House") %}
                media_player.house
              {%-elif is_state("input_select.streaming_audio", "Outside") %}
                media_player.outside_speakers
              {%-elif is_state("input_select.streaming_audio", "Den") %}
                media_player.den_home
              {%-elif is_state("input_select.streaming_audio", "Office") %}
                media_player.office_speaker
              {%-elif is_state("input_select.streaming_audio", "Kitchen") %}
                media_player.kitchen_home
              {%-elif is_state("input_select.streaming_audio", "Bathroom") %}
                media_player.bathroom_speaker
              {%-elif is_state("input_select.streaming_audio", "Bedroom") %}
                media_player.bedroom_speaker
              {% else %}
                "None"
              {% endif %}

- alias: Cast Media Based On Input Select
  trigger:
  - platform: state
    entity_id: input_select.radio_station
  action:
  - service: media_player.play_media
    data_template:
      entity_id: >
            {% if is_state("input_select.streaming_audio", "Living Room") %}
              media_player.living_room_home
            {%-elif is_state("input_select.streaming_audio", "Whole House") %}
              media_player.house
            {%-elif is_state("input_select.streaming_audio", "Outside") %}
              media_player.outdoor_speakers
            {%-elif is_state("input_select.streaming_audio", "Den") %}
              media_player.den_home
            {%-elif is_state("input_select.streaming_audio", "Office") %}
              media_player.office_speaker
            {%-elif is_state("input_select.streaming_audio", "Kitchen") %}
              media_player.kitchen_home
            {%-elif is_state("input_select.streaming_audio", "Bathroom") %}
              media_player.bathroom_speaker
            {%-elif is_state("input_select.streaming_audio", "Bedroom") %}
              media_player.bedroom_speaker
            {% else %}
              "None"
            {% endif %}
      media_content_id: >
            {% if is_state("input_select.radio_station", "KROQ") %}
              http://15363.live.streamtheworld.com:80/KROQFMDIALUP_SC
            {%-elif is_state("input_select.radio_station", "Jack FM") %}
              http://17793.live.streamtheworld.com:80/KCBSFMDIALUP_SC
            {%-elif is_state("input_select.radio_station", "Nova 100") %}
              http://streaming.novaentertainment.com.au/nova100
            {%-elif is_state("input_select.radio_station", "SmoothFM") %}
              http://streaming.novaentertainment.com.au/smooth915 
            {%-elif is_state("input_select.radio_station", "SBS Chill") %}
              http://shoutcast.sbs.com.au/SBSChill
            {% else %}
              "None"
            {% endif %}
      media_content_type: 'audio/mp4'

################################################
#
#      Zwave Automations
#
################################################

# - alias: Notify dryer died
  # trigger:
    # platform: state
    # entity_id: zwave.dryer
    # to: 'dead'
  # action:
  # - service: zwave.test_node
    # data:
      # node_id: 11
  # - service: notify.chrome
    # data:
      # message: "Dryer zwave died"
      # target: danny_pixel
      # title: Shokabow Zoo

# - alias: Notify washer died
  # trigger:
    # platform: state
    # entity_id: zwave.washer
    # to: 'dead'
  # action:
  # - service: zwave.test_node
    # data:
      # node_id: 10
  # - service: notify.chrome
    # data:
      # message: "Washer zwave died"
      # target: danny_pixel
      # title: Shokabow Zoo

# - alias: Notify bedroom lights died
  # trigger:
    # platform: state
    # entity_id: zwave.bedroom_lights
    # to: 'dead'
  # action:
  # - service: zwave.test_node
    # data:
      # node_id: 2
  # - service: notify.chrome
    # data:
      # message: "bedroom lights zwave died"
      # target: danny_pixel
      # title: Shokabow Zoo

# - alias: Notify lock died
  # trigger:
    # platform: state
    # entity_id: zwave.front_door_lock
    # to: 'dead'
  # action:
  # - service: zwave.test_node
    # data:
      # node_id: 23
  # - service: notify.chrome
    # data:
      # message: "front door lock zwave died"
      # target: danny_pixel
      # title: Shokabow Zoo
      
- alias: Notify zwave device died
  trigger:
    platform: template
    value_template: >
      {%- for state in states.zwave -%}
        {%- if state.state == "dead" -%}
          true
        {%- endif -%}
      {%- endfor -%}
  action:
  - service: notify.chrome
    data_template:
      message: "node {{ trigger.entity_id }} has died"
      target: danny_pixel
      title: Shokabow Zoo


# - alias: Notify zwave network ready
  # trigger:
    # platform: event
    # event_type: zwave.network_ready
  # action:
  # - service: notify.slack
    # data:
      # message: "The Z-Wave network is now ready"
      
################################################
#
#      Bayesian Automations
#
################################################

- alias: Notify bayesian on
  trigger:
    platform: state
    entity_id: binary_sensor.dannys_bayesian_presence
    to: 'on'
  condition:
    condition: state
    entity_id: switch.tasker_sleep_danny
    state: 'off'
  action:
  - service: notify.chrome
    data:
      message: "Welcome home, do you need help?"
      target: danny_pixel
      title: Shokabow Zoo
      data:
        actions:
        - action: "help"
          title: "Yes"

- alias: Notify help needed at cars
  trigger:
    platform: event
    event_type: html5_notification.clicked
    event_data:
      action: help
  action:
  - service: tts.google_say
    #entity_id: media_player.home_notification
    #entity_id: media_player.den_home, media_player.kitchen_home, media_player.bedroom_speaker, media_player.office_speaker, media_player.bathroom_speaker, media_player.living_room_home
    data_template:
      message: 'Boogie, I need help outside'
      entity_id: >
        {% if states.media_player.home_notification.state != 'unavailable' %}
          media_player.home_notification
        {% else %}
          media_player.den_home, media_player.kitchen_home, media_player.bedroom_speaker, media_player.office_speaker, media_player.bathroom_speaker, media_player.living_room_home
        {%endif %}
        
- alias: Notify bayesian off
  trigger:
    platform: state
    entity_id: binary_sensor.dannys_bayesian_presence
    to: 'off'
  condition:
    condition: state
    entity_id: switch.tasker_sleep_danny
    state: 'off'
  action:
  - service: notify.chrome
    data:
      message: "You are not home, did you forget anything?"
      target: danny_pixel
      title: Shokabow Zoo
      
- alias: Notify bayesian on tosh
  trigger:
    platform: state
    entity_id: binary_sensor.natachas_bayesian_presence
    to: 'on'
  condition:
    condition: state
    entity_id: switch.tasker_sleep_tosh
    state: 'off'
  action:
  - service: notify.chrome
    data:
      message: "Welcome home, do you need help?"
      target: ["danny_pixel", "tosh_phone"]
      title: Shokabow Zoo
      data:
        actions:
        - action: "help"
          title: "Yes"

- alias: Notify bayesian off tosh
  trigger:
    platform: state
    entity_id: binary_sensor.natachas_bayesian_presence
    to: 'off'
  condition:
    condition: state
    entity_id: switch.tasker_sleep_tosh
    state: 'off'
  action:
  - service: notify.chrome
    data:
      message: "Tosh has left the zoo.  Did you forget anything?"
      target: ["danny_pixel", "tosh_phone"]
      title: Shokabow Zoo
      
################################################
#
#      Thermostat Automations
#
################################################

- alias: Cool down house if thermostat gets above 80
  trigger:
  - platform: numeric_state
    entity_id: climate.thermostat_cooling_1
    value_template: "{{ states.climate.thermostat_cooling_1.attributes.current_temperature }}"
    above: 79
  action:
  - service: climate.set_temperature
    data:
      entity_id: climate.thermostat_cooling_1
      #operation_mode: 'Cool'
      temperature: 78
  - service: climate.set_operation_mode
    data:
      entity_id: climate.thermostat_cooling_1
      operation_mode: 'Cool'

- alias: Set thermostat cooling if on and house is armed
  trigger:
  - platform: state
    entity_id: alarm_control_panel.home
    to: 'armed_away'
  condition:
    condition: and
    conditions:
    - condition: template
      value_template: "{{ states.climate.thermostat_cooling_1.attributes.operation_mode == 'Cool' }}"
    - condition: template
      value_template: "{{ states.climate.thermostat_cooling_1.attributes.temperature < 78 }}"
  action:
  - service: climate.set_temperature
    data:
      entity_id: climate.thermostat_cooling_1
      temperature: 78

- alias: Set thermostat heating if on and house is armed
  trigger:
  - platform: state
    entity_id: alarm_control_panel.home
    to: 'armed_away'
  condition:
    condition: and
    conditions:
    - condition: template
      value_template: "{{ states.climate.thermostat_heating_1.attributes.operation_mode == 'Heat' }}"
    - condition: template
      value_template: "{{ states.climate.thermostat_heating_1.attributes.temperature > 70 }}"
  action:
  - service: climate.set_temperature
    data:
      entity_id: climate.thermostat_heating_1
      temperature: 70
      
################################################
#
#      Movie Mode Automations
#
################################################

- alias: Movie mode turned on
  trigger:
    platform: state
    entity_id: input_boolean.movie_mode
    to: 'on'
  action:
  - service: light.turn_on
    entity_id: light.tv_lights
    data:
      brightness_pct: 100
      kelvin: 6500
  - service: light.turn_off
    entity_id: light.kitchen_lights_level, light.corner_lamp, light.patio, light.living_room_lights_level, light.office_lights, light.bedroom_lights_level
  - service: switch.turn_off
    entity_id: switch.island_lights_switch
  - condition: state
    entity_id: switch.fireplace
    state: 'off'
  - service: switch.turn_on
    entity_id: switch.fireplace

- alias: Movie mode watch pc
  trigger:
    platform: state
    entity_id: input_boolean.movie_mode
    to: 'on'
  condition:
    condition: template
    value_template: "{{ states.remote.harmony_hub_den.attributes.current_activity == PowerOff }}"
  action:
    service: script.turn_on
    entity_id: script.pc
    
- alias: Movie mode curtains if sun is above horizon
  trigger:
    platform: state
    entity_id: input_boolean.movie_mode
    to: 'on'
  condition:
    condition: state
    entity_id: sun.sun
    state: above_horizon
  action:
  - service: script.turn_on
    entity_id: script.close_den_curtains
    
- alias: Turn off lights when movie plays
  trigger:
    platform: state
    entity_id: media_player.kodi_den
    to: 'playing'
  condition:
    condition: state
    entity_id: input_boolean.movie_mode
    state: 'on'
  action:
  - service: light.turn_off
    entity_id: light.den_lights_level, light.kitchen_lights_level, light.living_room_lights_level, light.patio, light.corner_lamp
  - service: switch.turn_off
    entity_id: switch.island_lights_switch
    
- alias: Turn on lights when movie paused
  trigger:
  - platform: state
    entity_id: media_player.kodi_den
    to: 'paused'
    for:
      seconds: 30
  - platform: state
    entity_id: media_player.kodi_den
    to: 'idle'
    for:
      minutes: 1
  condition:
    condition: state
    entity_id: input_boolean.movie_mode
    state: 'on'
  action:
  - service: light.turn_on
    entity_id: light.kitchen_lights_level
  - service: light.turn_on
    entity_id: light.den_lights_level
    data:
      brightness_pct: 10

- alias: Movie mode turned off and den curtains were closed
  trigger:
    platform: state
    entity_id: input_boolean.movie_mode
    to: 'off'
  condition:
    condition: state
    entity_id: input_boolean.den_curtains
    state: 'off'
  action:
  - service: script.turn_on
    entity_id: script.open_den_curtains
    
- alias: Movie mode off when harmony hub turns off
  trigger:
    platform: state
    entity_id: remote.harmony_hub_den
    to: 'off'
  condition:
    condition: state
    entity_id: input_boolean.movie_mode
    state: 'on'
  action:
    service: input_boolean.turn_off
    entity_id: input_boolean.movie_mode
    
- alias: Turn off den lights if movie is already playing when movie mode turned on
  trigger:
    platform: state
    entity_id: input_boolean.movie_mode
    to: 'on'
  condition:
    condition: or
    conditions:
    - condition: state
      entity_id: media_player.kodi_den
      state: playing
    - condition: template
      value_template: '{{ states.remote.harmony_hub_den.attributes.current_activity != "Watch PC" }}'
  action:
    service: light.turn_off
    entity_id: light.den_lights_level
    
################################################
#
#      Water Heater Notification
#
################################################

- alias: Water heater notification
  trigger:
    platform: state
    entity_id: binary_sensor.water_leak_sensor_158d0001bc24f5
    to: 'on'
  condition:
    condition: state
    entity_id: binary_sensor.shokabow_weather_rain
    state: 'off'
  action:
  - service: notify.chrome
    data:
      message: "The water heater is leaking"
      target: ["danny_pixel", "tosh_phone"]
      title: Shokabow Zoo
  - condition: state
    entity_id: group.tracked_users
    state: 'home'
  - service: tts.google_say
    #entity_id: media_player.home_notification
    #entity_id: media_player.den_home, media_player.kitchen_home, media_player.bedroom_speaker, media_player.office_speaker, media_player.bathroom_speaker, media_player.living_room_home
    data_template:
      message: 'The water heater is leaking'
      entity_id: >
        {% if states.media_player.home_notification.state != 'unavailable' %}
          media_player.home_notification
        {% else %}
          media_player.den_home, media_player.kitchen_home, media_player.bedroom_speaker, media_player.office_speaker, media_player.bathroom_speaker, media_player.living_room_home
        {%endif %}
        
- alias: Water heater and rain notification
  trigger:
    platform: state
    entity_id: binary_sensor.water_leak_sensor_158d0001bc24f5
    to: 'on'
  condition:
    condition: state
    entity_id: binary_sensor.shokabow_weather_rain
    state: 'on'
  action:
  - service: notify.chrome
    data:
      message: "There is rain getting into the water heater"
      target: ["danny_pixel", "tosh_phone"]
      title: Shokabow Zoo
  - condition: state
    entity_id: group.tracked_users
    state: 'home'
  - service: tts.google_say
    #entity_id: media_player.home_notification
    #entity_id: media_player.den_home, media_player.kitchen_home, media_player.bedroom_speaker, media_player.office_speaker, media_player.bathroom_speaker, media_player.living_room_home
    data_template:
      message: 'There is rain getting into the water heater'
      entity_id: >
        {% if states.media_player.home_notification.state != 'unavailable' %}
          media_player.home_notification
        {% else %}
          media_player.den_home, media_player.kitchen_home, media_player.bedroom_speaker, media_player.office_speaker, media_player.bathroom_speaker, media_player.living_room_home
        {%endif %}
        
################################################
#
#      Battery Notification
#
################################################

- alias: Battery Alert
  trigger:
    - platform: time
      at: '10:00:00'
    - platform: time
      at: '18:00:00'
  condition:
    - condition: template
      value_template: >
          {%- set threshold = 25 -%}
          {% macro battery_level() %}
          {% set domains = ['light', 'switch', 'sensor', 'zwave', 'lock'] %}
          {% for domain in domains -%}
          {% for item in states[domain] if ((item.attributes.battery_level is defined and item.attributes['battery_level'] | int < threshold) or ("battery" in item.name | lower and ((item.state | int < threshold and item.state|int != 0) or item.state | lower == "low" or item.state | lower == "unknown"))) -%}
          {% if (item.attributes.battery_level is defined and item.attributes['battery_level'] | int < threshold) -%}
          {{ item.name }}{% endif -%}
          {% if "battery" in item.name | lower and ((item.state | int < threshold and item.state|int != 0) or item.state | lower == "low" or item.state | lower == "unknown") -%}
          {{ item.name }}{% endif -%}
          {% endfor %}
          {%- endfor %}
          {% endmacro %}
          {{ battery_level() |trim != "" }}
  action:
    - service: persistent_notification.create
      data_template:
        title: "Low Battery levels"
        notification_id: low-battery-alert
        message: >
          {%- set threshold = 25 -%}
          {% macro battery_level(domain) %}
          {%- for item in states[domain] if ((item.attributes.battery_level is defined and item.attributes['battery_level'] | int < threshold) or ("battery" in item.name | lower and ((item.state | int < threshold and item.state|int != 0) or item.state | lower == "low" or item.state | lower == "unknown"))) -%}
          {% if (item.attributes.battery_level is defined and item.attributes['battery_level'] | int < threshold) -%}
          {{ item.name }} ({{ item.attributes['battery_level'] }}){%- if not loop.last %}, {% endif -%}{%- endif -%}
          {%- if "battery" in item.name | lower and ((item.state | int < threshold and item.state|int != 0) or item.state | lower == "low" or item.state | lower == "unknown") -%}
          {{ item.name }} ({{ item.state }}){% if not loop.last %}, {% endif %}{% endif -%}
          {%- endfor -%}
          {% endmacro %}
          {%- set domains = ['light', 'switch', 'sensor', 'zwave', 'lock'] -%}
          {%- for domain in domains if battery_level(domain) |trim != ""-%}
          {{ battery_level(domain) }}{%- if not loop.last %}, {% endif -%}
          {%- endfor -%}
    - service: notify.chrome
      data_template:
        title: "Battery status"
        target: ["danny_pixel", "tosh_phone"]
        message: >
          {% macro battery_level() %}
          {%- set threshold = 25 -%}
          {% set domains = ['light', 'switch', 'sensor', 'zwave', 'lock'] %}
          {% for domain in domains -%}
          {% for item in states[domain] if ((item.attributes.battery_level is defined and item.attributes['battery_level'] | int < threshold) or ("battery" in item.name | lower and ((item.state | int < threshold and item.state|int != 0) or item.state | lower == "low" or item.state | lower == "unknown"))) -%}
          {% if (item.attributes.battery_level is defined and item.attributes['battery_level'] | int < threshold) -%}
          {{ item.name }} ({{ item.attributes['battery_level'] }}){%- if not loop.last %}, {% endif -%}{% endif -%}
          {% if "battery" in item.name | lower and ((item.state | int < threshold and item.state|int != 0) or item.state | lower == "low" or item.state | lower == "unknown") -%}
          {{ item.name }} ({{ item.state }}){% if not loop.last %}, {%- endif %} {% endif -%}
          {% endfor %}
          {%- endfor %}
          {% endmacro %}
          {{ battery_level()}}

- alias: Battery Alert Clear
  trigger:
    - platform: time
      minutes: '/30'
      seconds: 00
  condition:
    - condition: template
      value_template: >
        {%- set threshold = 25 -%}
        {% macro battery_level() %}
        {% set domains = ['light', 'switch', 'sensor', 'zwave', 'lock'] %}
        {% for domain in domains -%}
        {% for item in states[domain] if ((item.attributes.battery_level is defined and item.attributes['battery_level'] | int < threshold) or ("battery" in item.name | lower and ((item.state | int < threshold and item.state|int != 0) or item.state | lower == "low" or item.state | lower == "unknown"))) -%}
        {% if (item.attributes.battery_level is defined and item.attributes['battery_level'] | int < threshold) -%}
        {{ item.name }}{% endif -%}
        {% if "battery" in item.name | lower and ((item.state | int < threshold and item.state|int != 0) or item.state | lower == "low" or item.state | lower == "unknown") -%}
        {{ item.name }}{% endif -%}
        {% endfor %}
        {%- endfor %}
        {% endmacro %}
        {{ battery_level() |trim == "" }}
  action:
    - service: persistent_notification.dismiss
      data:
        notification_id: low-battery-alert
        
################################################
#
#      Xiaomi Price Notification
#
################################################

# - alias: Xiaomi Air Purifier Price
  # trigger:
  # - platform: numeric_state
    # entity_id: sensor.xiaomi_air_purifier_2
    # below: 130
  # action:
  # - service: notify.chrome
    # data:
      # message: "Price dropped below $130 for air purifier. Click to buy!"
      # target: danny_pixel
      # title: Shokabow Zoo
      # data:
        # url: 'https://www.gearbest.com/home-smart-improvements/pp_268522.html'
        
# - alias: Xiaomi Leak Sensor Price
  # trigger:
  # - platform: numeric_state
    # entity_id: sensor.xiaomi_leak_sensor
    # below: 10
  # action:
  # - service: notify.chrome
    # data:
      # message: "Price dropped below $10 for leak sensor. Click to buy!"
      # target: danny_pixel
      # title: Shokabow Zoo
      # data:
        # url: 'https://www.gearbest.com/home-smart-improvements/pp_668897.html'
        
################################################
#
#      Log Notification
#
################################################

- alias: Create notifications for "timer" errors
  trigger:
    platform: event
    event_type: system_log_event
  condition:
    condition: template
    value_template: '{{ "Timer" in trigger.event.data.message }}'
  action:
  - service: persistent_notification.create
    data_template:
      title: Something bad happened
      message: '{{ trigger.event.data.message }}'
  - service: notify.chrome
    data:
      message: "Timer out of sync"
      target: danny_pixel
      title: Shokabow Zoo
  
################################################
#
#      Speed Test Automations
#
################################################

- alias: Speed test
  trigger:
    - platform: time
      at: "01:00:00"
    - platform: time
      at: "05:00:00"
    - platform: time
      at: "13:00:00"
    - platform: time
      at: "17:00:00"
  condition:
    - condition: template
      value_template: "{{ states('sensor.plex')|int == 0 }}"
    - condition: template
      value_template: "{{ states('sensor.sabnzbd_speed')|int == 0 }}"
  action:
    - service: sensor.update_speedtest
    
################################################
#
#      Numeric automations
#
################################################

- alias: Certificate Expiring
  trigger:
  - platform: numeric_state
    entity_id: sensor.ssl_certificate_expiry
    below: 5
  action:
  - service: notify.chrome
    data:
      message: "Certificate expiring in {{ states.sensor.ssl_certificate_expiry.state }} days!"
      target: danny_pixel
      title: Shokabow Zoo
      
- alias: Disk Getting Full
  trigger:
    platform: numeric_state
    entity_id: sensor.disk_use_percent_home
    above: 50
  action:
  - service: notify.chrome
    data:
      message: "Home assistant drive getting full, over 50%! Check journal and zoneminder."
      target: danny_pixel
      title: Shokabow Zoo
      
################################################
#
#      Shower Automations
#
################################################

- alias: Shower Mode Turned On
  trigger:
    platform: state
    entity_id: input_boolean.shower_mode
    to: 'on'
  action:
  - service: switch.turn_on
    entity_id: switch.house_fan
  - delay: "00:00:10"
  - service: media_player.play_media
    data:
      entity_id: media_player.bathroom_speaker
      media_content_id: "http://15363.live.streamtheworld.com:80/KROQFMDIALUP_SC"
      media_content_type: "audio/mp4"
      
- alias: Shower Mode Turned Off
  trigger:
    platform: state
    entity_id: input_boolean.shower_mode
    to: 'off'
  action:
  - service: switch.turn_off
    entity_id: switch.house_fan
  - service: media_player.media_stop
    entity_id: media_player.bathroom_speaker
    
- alias: Shower Mode On and bathroom window still open
  trigger:
    platform: state
    entity_id: input_boolean.shower_mode
    to: 'on'
    for:
      minutes: 2
  condition:
    condition: state
    entity_id: binary_sensor.bathroom_window
    state: 'off'
  action:
  - service: media_player.media_play_pause
    entity_id: media_player.bathroom_speaker
  - delay: "00:00:02"
  - service: tts.google_say
    entity_id: media_player.bathroom_speaker
    data:
      message: "Please open the bathroom window"
  - delay: "00:00:05"
  - service: media_player.play_media
    data:
      entity_id: media_player.bathroom_speaker
      media_content_id: "http://15363.live.streamtheworld.com:80/KROQFMDIALUP_SC"
      media_content_type: "audio/mp4"
    
- alias: Shower mode off if bathroom speaker not playing
  trigger:
  - platform: state
    entity_id: media_player.bathroom_speaker
    to: 'paused'
    for:
      minutes: 30
  - platform: state
    entity_id: alarm_control_panel.home
    to: 'armed_away'
  - platform: state
    entity_id: media_player.bathroom_speaker
    to: 'off'
    for:
      minutes: 5
  condition:
    condition: state
    entity_id: input_boolean.shower_mode
    state: 'on'
  action:
    service: input_boolean.turn_off
    entity_id: input_boolean.shower_mode
    
- alias: Shower mode on when humidity above 75 for 2 minutes
  trigger:
    platform: numeric_state
    entity_id: sensor.bathroom_humidity
    above: 75
    for:
      minutes: 1
  condition:
    condition: and
    conditions:
    - condition: state
      entity_id: alarm_control_panel.home
      state: disarmed
    - condition: state
      entity_id: input_boolean.night_mode
      state: 'off'
  action:
    service: input_boolean.turn_on
    entity_id: input_boolean.shower_mode
    
- alias: Play music again if interrupted
  trigger:
    platform: state
    entity_id: media_player.bathroom_speaker
    to: 'idle'
    for:
      seconds: 20
  condition:
    condition: state
    entity_id: input_boolean.shower_mode
    state: 'on'
  action:
  - service: media_player.play_media
    data:
      entity_id: media_player.bathroom_speaker
      media_content_id: "http://15363.live.streamtheworld.com:80/KROQFMDIALUP_SC"
      media_content_type: "audio/mp4"
      
################################################
#
#      Motion Light Automations
#
################################################

- alias: Bedroom Motion Light
  trigger:
  - platform: state
    entity_id: binary_sensor.bedroom_motion_sensor
    to: 'on'
  - platform: state
    entity_id: binary_sensor.bedroom_door
    to: 'on'
  condition:
    condition: and
    conditions:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.night_mode
      state: 'off'
    - condition: state
      entity_id: alarm_control_panel.home
      state: disarmed
    - condition: state
      entity_id: switch.tasker_sleep_danny
      state: 'off'
    - condition: state
      entity_id: switch.tasker_sleep_tosh
      state: 'off'
  action:
  - service: light.turn_on
    entity_id: light.bedroom_lights_level
  - delay: "00:03:00"
  - wait_template: "{{ states.binary_sensor.bedroom_motion_sensor.state == 'off' }}"
  - condition: state
    entity_id: binary_sensor.bedroom_door
    state: 'off'
  - service: light.turn_off
    entity_id: light.bedroom_lights_level

################################################
#
#      Ring Automations
#
################################################

- alias: Motion at front door
  trigger:
    platform: state
    entity_id: binary_sensor.ring_front_door_motion
    to: 'on'
  condition:
    condition: and
    conditions:
    - condition: state
      entity_id: alarm_control_panel.home
      state: disarmed
    - condition: state
      entity_id: lock.front_door_lock_locked
      state: locked
  action:
  - service: notify.den
    data:
      data:
        color: teal
      message: There is motion at the front door
      title: Shokabow Zoo
  
- alias: Ding Dong at front door
  trigger:
    platform: state
    entity_id: binary_sensor.ring_front_door_ding
    to: 'on'
  condition:
    condition: state
    entity_id: alarm_control_panel.home
    state: disarmed
  action:
  - service: notify.den
    data:
      data:
       color: red
       duration: 10
       position: center
      message: Someone is at the front door
      title: Shokabow Zoo
      
################################################
#
#      Sink Leaking Automations
#
################################################

- alias: Sink is leaking
  trigger:
  - platform: state
    entity_id: binary_sensor.kitchen_sink_leak_sensor
    to: 'on'
  - platform: state
    entity_id: binary_sensor.bar_sink_leak_sensor
    to: 'on'
  - platform: state
    entity_id: binary_sensor.bathroom_sink_leak_sensor
    to: 'on'
  action:
  - service: notify.den
    data_template:
      data:
        color: red
        duration: 10
        position: center
      message: 'Leak Detected! {{ trigger.to_state.attributes.friendly_name }}'
      title: Shokabow Zoo
  - service: notify.chrome
    data_template:
      message: "Leak Detected {{ trigger.to_state.attributes.friendly_name }}"
      target: ["danny_pixel", "tosh_phone"]
      title: Shokabow Zoo
  - service: notify.slack
    data_template:
      message: "Leak detected at home {{ trigger.to_state.attributes.friendly_name }}"
      
################################################
#
#      Hallway Switch Automations
#
################################################

- alias: Turn On Hallway Light Bright White
  trigger:
    platform: event
    event_type: click
    event_data:
      entity_id: binary_sensor.hallway_office_switch
      click_type: long_click_press
  action:
  - service: light.turn_on
    entity_id: light.hallway_light
    data:
      kelvin: 6500
      brightness_pct: 100
      
- alias: Turn On Office Lights From Switch
  trigger:
    platform: event
    event_type: click
    event_data:
      entity_id: binary_sensor.hallway_office_switch
      click_type: single
  action:
  - service: light.turn_on
    entity_id: light.office_lights
    
- alias: Turn Off Office Lights and Hallway From Switch
  trigger:
    platform: event
    event_type: click
    event_data:
      entity_id: binary_sensor.hallway_office_switch
      click_type: double
  action:
  - service: light.turn_off
    entity_id: light.hallway_light, light.office_lights
    
################################################
#
#      Car Presence Automations
#
################################################

- alias: Danny car
  trigger:
  - platform: state
    entity_id: binary_sensor.tsxpresence
    to: 'on'
  - platform: state
    entity_id: binary_sensor.tsxpresence
    to: 'off'
  action:
  - service: notify.chrome
    data_template:
      message: >
        {% if is_state("binary_sensor.tsxpresence", "on") %}
          TSX turned on or arrived home
        {% elif is_state("binary_sensor.tsxpresence", "off") %}
          TSX turned off or left home
        {% else %}
        {% endif %}
      target: danny_pixel
      title: Shokabow Zoo
      
- alias: Tosh car
  trigger:
  - platform: state
    entity_id: binary_sensor.rdxpresence
    to: 'on'
  - platform: state
    entity_id: binary_sensor.rdxpresence
    to: 'off'
  action:
  - service: notify.chrome
    data_template:
      message: >
        {% if is_state("binary_sensor.rdxpresence", "on") %}
          RDX turned on or arrived home
        {% elif is_state("binary_sensor.rdxpresence", "off") %}
          RDX turned off or left home
        {% else %}
        {% endif %}
      target: danny_pixel
      title: Shokabow Zoo
      
################################################
#
#      BBQ Automations
#
################################################
 
- alias: BBQ Notifications
  trigger:
    platform: state
    entity_id: input_select.bbq_probe1
    from: "Select Input"
  condition:
    condition: state
    entity_id: binary_sensor.bbq1
    state: 'on'
  action:
  - wait_template: >
     {% if is_state("input_select.bbq_probe1", "Beef Ribs") -%}
       {{ states.sensor.bbq1temperature.state|int >= 195 }}
     {% elif is_state("input_select.bbq_probe1", "Brisket") -%}
       {{ states.sensor.bbq1temperature.state|int >= 195 }}
     {% elif is_state("input_select.bbq_probe1", "Chicken") -%}
       {{ states.sensor.bbq1temperature.state|int >= 155 }}
     {% elif is_state("input_select.bbq_probe1", "Tritip") -%}
       {{ states.sensor.bbq1temperature.state|int >= 120 }}
     {%- else -%}
     {%- endif %}
  - service: notify.chrome
    data_template:
      message: >
       {% if is_state("input_select.bbq_probe1", "Beef Ribs") -%}
         Beef Ribs are almost ready
       {% elif is_state("input_select.bbq_probe1", "Brisket") -%}
         Briket is almost ready
       {% elif is_state("input_select.bbq_probe1", "Chicken") -%}
         Chicken is almost ready
       {% elif is_state("input_select.bbq_probe1", "Tritip") -%}
         Tritip is almost ready
       {%- else -%}
       {%- endif %}
      target: danny_pixel
      title: Shokabow Zoo
  - service: tts.google_say
    #entity_id: media_player.home_notification
    #entity_id: media_player.den_home, media_player.kitchen_home, media_player.bedroom_speaker, media_player.office_speaker, media_player.bathroom_speaker, media_player.living_room_home
    data_template:
      message: >
       {% if is_state("input_select.bbq_probe1", "Beef Ribs") -%}
         Beef Ribs are almost ready
       {% elif is_state("input_select.bbq_probe1", "Brisket") -%}
         Briket is almost ready
       {% elif is_state("input_select.bbq_probe1", "Chicken") -%}
         Chicken is almost ready
       {% elif is_state("input_select.bbq_probe1", "Tritip") -%}
         Tritip is almost ready
       {%- else -%}
       {%- endif %}
      entity_id: >
        {% if states.media_player.home_notification.state != 'unavailable' %}
          media_player.home_notification
        {% else %}
          media_player.den_home, media_player.kitchen_home, media_player.bedroom_speaker, media_player.office_speaker, media_player.bathroom_speaker, media_player.living_room_home
        {%endif %}
  - wait_template: >
     {% if is_state("input_select.bbq_probe1", "Beef Ribs") -%}
       {{ states.sensor.bbq1temperature.state|int >= 205 }}
     {% elif is_state("input_select.bbq_probe1", "Brisket") -%}
       {{ states.sensor.bbq1temperature.state|int >= 205 }}
     {% elif is_state("input_select.bbq_probe1", "Chicken") -%}
       {{ states.sensor.bbq1temperature.state|int >= 165 }}
     {% elif is_state("input_select.bbq_probe1", "Tritip") -%}
       {{ states.sensor.bbq1temperature.state|int >= 130 }}
     {%- else -%}
     {%- endif %}
  - service: notify.chrome
    data_template:
      message: >
       {% if is_state("input_select.bbq_probe1", "Beef Ribs") -%}
         Beef Ribs are done
       {% elif is_state("input_select.bbq_probe1", "Brisket") -%}
         Briket is done
       {% elif is_state("input_select.bbq_probe1", "Chicken") -%}
         Chicken is done
       {% elif is_state("input_select.bbq_probe1", "Tritip") -%}
         Tritip is done
       {%- else -%}
       {%- endif %}
      target: danny_pixel
      title: Shokabow Zoo
  - service: tts.google_say
    #entity_id: media_player.home_notification
    #entity_id: media_player.den_home, media_player.kitchen_home, media_player.bedroom_speaker, media_player.office_speaker, media_player.bathroom_speaker, media_player.living_room_home
    data_template:
      message: >
       {% if is_state("input_select.bbq_probe1", "Beef Ribs") -%}
         Beef Ribs are done
       {% elif is_state("input_select.bbq_probe1", "Brisket") -%}
         Briket is done
       {% elif is_state("input_select.bbq_probe1", "Chicken") -%}
         Chicken is done
       {% elif is_state("input_select.bbq_probe1", "Tritip") -%}
         Tritip is done
       {%- else -%}
       {%- endif %}
      entity_id: >
        {% if states.media_player.home_notification.state != 'unavailable' %}
          media_player.home_notification
        {% else %}
          media_player.den_home, media_player.kitchen_home, media_player.bedroom_speaker, media_player.office_speaker, media_player.bathroom_speaker, media_player.living_room_home
        {%endif %}
  - service: notify.den
    data_template:
      data:
        color: red
        duration: 30
        position: center
      message: >
       {% if is_state("input_select.bbq_probe1", "Beef Ribs") -%}
         Beef Ribs are done
       {% elif is_state("input_select.bbq_probe1", "Brisket") -%}
         Briket is done
       {% elif is_state("input_select.bbq_probe1", "Chicken") -%}
         Chicken is done
       {% elif is_state("input_select.bbq_probe1", "Tritip") -%}
         Tritip is done
       {%- else -%}
       {%- endif %}
      title: Shokabow Zoo
  - service: input_select.select_option
    entity_id: input_select.bbq_probe1
    data:
      option: "Select Input"
      
- alias: BBQ notifications not on
  trigger:
  - platform: state
    entity_id: input_select.bbq_probe1
    from: "Select Input"
  condition:
    condition: state
    entity_id: binary_sensor.bbq1
    state: 'off'
  action:
  - delay: "00:00:20"
  - service: input_select.select_option
    entity_id: input_select.bbq_probe1
    data:
      option: "Select Input"

- alias: Set BBQ override
  trigger:
    platform: state
    entity_id: input_select.bbq_probe1
  condition:
    condition: state
    entity_id: binary_sensor.bbq1
    state: 'on'
  action:
  - service: input_number.set_value
    data_template:
      entity_id: input_number.bbq1_override
      value: >
       {% if is_state("input_select.bbq_probe1", "Beef Ribs") -%}
         205
       {% elif is_state("input_select.bbq_probe1", "Brisket") -%}
         205
       {% elif is_state("input_select.bbq_probe1", "Chicken") -%}
         165
       {% elif is_state("input_select.bbq_probe1", "Tritip") -%}
         130
       {% elif is_state("input_select.bbq_probe1", "Select Input") -%}
         130
       {%- else -%}
       {%- endif %}

################################################
#
#      Pool Pump Automations
#
################################################

- alias: Notify pool pump offline
  trigger:
    platform: numeric_state
    entity_id: sensor.pool_pump_power
    below: 3
    for:
      minutes: 10
  action:
  - service: notify.chrome
    data:
      message: "Pool pump is offline, go outside and hit reset"
      target: danny_pixel
      title: Shokabow Zoo